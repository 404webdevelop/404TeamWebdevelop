<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="/static/json2.js"></script>
<!--source from https://github.com/douglascrockford/JSON-js/blob/master/json2.js -->


</head>

<body>

<button>获得 JSON 数据</button>
<p></p>
<script type="text/javascript">
/*$(document).ready(function(){
  $("button").click(function(){
    console.log(123);
    $.getJSON("http://127.0.0.1:8000/api/authors/?format=json",function(result){
        //var thing = result;
        $("#show_json").append(result[0].username);
      });
    });
  });*/

  /*var frm = $('#login');
    frm.submit(function () {
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $("#show").html(data);
            },
            error: function(data) {
                $("#error").html("Something went wrong!");
            }
        });
        return false;
    });*/



$(document).ready(function(){
    $("#but").click(function(){
        console.log(113);
        var username = $("#username").val();
        var password = $("#password").val();
        var data = {"username":username,"password":password};
        //var obj = JSON.parse(data);
        var url = "http://127.0.0.1:8000/api-token/";
        sendJSONXMLHTTPRequest(url,data,function(answer){
            $("#response").html(answer);
        });

        $("#show").html(username);
        $("#error").html(password);

    });
});
function sendJSONXMLHTTPRequest(url, objects, callback) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState==4) {
            try {
                if (xhr.status==200) {
                    //XXX: parse some JSON from the request!
                    //XXX: Pass the data to the callback!
        var v = JSON.parse(xhr.responseText);
                        if (callback)
                        {
                            alert(v)
                        }
                }
            } 
            catch(e) {
                $("#response").html('Error: ' + e.name);
            }
        }
    };
    //XXX: POST to a URL
    //XXX: set the mimetype and the accept headers!
    // Remember to use application/json !
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-type","application/json");
    xhr.setRequestHeader("Accept","application/json");
    xhr.send(JSON.stringify(objects));
};







/*$("#but").click(function() {

    var username = $("#username").val();
    var password = $("#password").val();
    var url = "http://http://127.0.0.1:8000/api-token/"; // the script where you handle the form input.

    $.ajax({
           type: "POST",
           url: url,
           contentType:"application/json"
           data: JSON.stringify({
            "username": username;
            "password": password; 
           })},dataType:"json"
         });

    $("#show").html(username);
    $("#error").html(password);
    //return false; // avoid to execute the actual submit of the form.
});*/



</script>
<p id="show_json"></p>

    <p><input id = "username"type="text" name="login" value="" placeholder="Username or Email"></p>
    <p><input id= "password"type="password" name="password" value="" placeholder="Password"></p>
    <button id="but">Default Button</button>


  data shows:
  <p id= "show"></p>
  error shows:
  <p id= "error"></p>
  response:
  <p id= "response"></p>

</body>
</html>
